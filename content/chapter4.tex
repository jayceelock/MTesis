\chapter{Pose Error Estimation}

\section{Introduction}

The main objective of this project is to determine the pose estimation accuracy of a quadcopter in flight. Here, the pose refers to a six-dimensional vector describing an objects three-dimensional position and angular orientation. This needs to be done in the outdoors to allow the quadcopter to use its global positioning sensor (GPS). To this end, a computer vision pose measurement system (CVS), which extracts six-dimensional pose data from a calibration object in the system's view, was designed and implemented. Before the CVS was used to make pose measurements, its measurement accuracy was first determined. 

In Chapter meme it was found that the pose measurement error of the CVS has high interdimensional dependence, as demonstrated by the covariance matrix of the error and the contour plots in Figure meme, and the data is fairly complex and noisy, despite using the RANSAC algorithm to filter out any outlier data points. This means that the measurement error is constantly changing and varies with the calibration board's current pose relative to the CVS's camera. In the context of this project, it is important to know what the accuracy of a pose measurement sample is, making it necessary to be able to determine the measurement error of any arbitrary pose measurement sample of the CVS.\@ It was decided that machine learning method will be employed to accomplish this. 

Machine learning is where a computer model is trained to recognise patterns within a set of input data and output information on those patterns which are of interest to the designer. 

This chapter sets out to 

\section{Model Design}

\subsection{Introduction}

\subsection{Background}

Designing a machine learning model can consist of three basic steps, the steps being

\begin{enumerate}
  \item Select machine learning model type.
  \item Train the model.
  \item Validate the model's accuracy. 
\end{enumerate}

First, the model type is selected. For this project, the radial basis neural network (RBFNN) was selected to perform the measurement error estimation on the CVS pose data. An artificial neural network was selected for this application, since there are complex non-linear interdimensional relationships in the error data, and neural networks excel at handling such data, as stated by~\cite{tu1996advantages}. Furthermore, the radial basis function network architecture was selected for its superior accuracy, compared to feed-forward networks, when handling large, noisy data sets, as determined by~\cite{xie2011comparison}. 

Next, model training takes place. Here, the network is trained to take an input and adjust is internal weights in such a way that the input data is best related to a desired output by using a supervised training scheme, such as the backpropagation procedure. In this case, the network input would be the six-dimensional pose vector produced by the CVS and the network output is the corresponding measurement error of the input pose vectors.  

Finally, to test and validate the accuracy of the trained model, it is tested with another set of input pose data of which the measurement error is already known. These two data sets can be used to select and refine the training parameters of the model. 

\subsection{Model Training}

Training a machine learning model is perhaps the most crucial aspect of the model design phase. Here the hidden layer of the RBFNN's nodes are initialised and assigned a weighting factor. This weight is selected in such a way that it minimises the difference between the network's output and the training error data by using the backpropagation method, demonstrated in Figure~\ref{fig:chap4-backprogagation}.

\begin{figure}
  \centering
  \includegraphics[width=0.5\textwidth]{figures/chapter4/backpropagation}
  \caption{back meme, adopted from wikipedia}
\label{fig:chap4-backprogagation}
\end{figure}

The backpropagation method works as follows. The hidden nodes are initialised with a weighting factor. The input training data is then fed to the network and the output is compared to the training output. Based on this difference, the different nodes' weighting factors are adjusted. Then, the input is fed to the adjusted network again the new error is compared to the output training data. This process is repeated until the means square error of the output's deviation from the training data falls below a set threshold. 

Factors that will affect the network's accuracy are the number of nodes in the hidden layer, as well as the strictness of fit. The number of hidden nodes is a measure of the complexity of the network and reflects the complexity of the data is can process. However, when too many nodes are selected, there is a significant risk that the model will only capture and attempt to model the noise and outlier data in a data set, instead of characterising the underlying relationships between the input and output. This phenomenon is known as overfitting and can be observed when a model with a very small training error is exposed to new input data and the error is a few orders of magnitude larger than for the training data. Here, the model describes the training data set very well, but any data set that is not very similar to the training data set will be handles very poorly. This is why the model validation phase is also a very important aspect of model training. 

To train the model for this project, two sets of data were used, one for training and another for the model validation. Both of these data sets are from the data sets generated during the Vicon measurement test, where the measurement accuracy of the CVS was determined by comparing its measurements to that of the measurements made by a Vicon system. It includes both the pose data from the CVS and the corresponding measurement error.It was decided to use 300 training samples, giving 50 samples per dimension. The input and output data were normalised to a range of $[-1, 1]$, since the pose vector contains different measurement units (degrees and metres). All subsequent inputs to and outputs from the network must be normalised and denormalised with the same values.  

Matlab's\footnote{MATLAB VERSION WHAAAT} Neural Network toolbox\footnote{NN VERSION WHAAAAT} was used to train the RBFNN and get the output for subsequent input data. The function prototype is given by 

\begin{center}
  \verb|net = newrb(P,T,goal,spread,MN,DF)|
\end{center}

Here, $P$ and $T$ are the $3\times6$ input and output training data matrices. The `goal' parameter is the error threshold for the training data, `spread' is the strictness of fit parameter, while $MN$ and $DF$ define the maximum number of hidden nodes and dictate the amount of nodes to increase by between each training iteration. Adjusting the `spread' and $MN$ parameters are the primary ways of adjusting the network's accuracy and output. 

\subsection{Model Validation}

The model validation phase is used to ensure that the RBFNN has been properly trained and that overfitting does not occur. The validation data set comes from the same Vicon test the training data comes from. Another 300 samples were used for the data set. 

The error was determined by feeding the validation input data into the trained network and comparing its output with the validation error data. The mean square error was used as a measure of accuracy. 

\section{Results}

With the training and validation data sets selected, the model design could begin. Different combinations of training parameters for the `newrb' Matlab function were tested. It was found that the `spread' parameter played the largest part in the mean square error during training. This is because the training data changes relatively quickly and contains a fair amount of noise. Therefore, forcing the RBFNN to go through all the points caused the mean square error to go up. It was decided to keep this parameter small to allow the RBFNN to describe the general trend in the data. 

Furthermore, changing the maximum number of nodes also influenced the accuracy of the network. Leaving the $MN$ parameter to its default will let the maximum number of hidden nodes go up to the number of samples, i.e.\ 300 nodes. This makes the network overly complex and it was found that the network performs better with both the training and validation data sets with a lower number of nodes. 

A combination that was found to work well, was a `spread' of 1\e{-3} and 20 hidden nodes. This combination gives a mean square error of approximately 3.0, whereas the default values of 1 and 300 gives a measn square error of 5\e{3} meme, indicating a significant improvement in accuracy.  

\section{Conclusion}

%\section{Prediction Model Design}

%\subsection{Introduction}

%The field of machine learning has produced various methods and algorithms over the many years it has been active, each of them having their own characteristics, strengths and drawbacks. For this project, artificial neural networks (ANN) were considered. It has been found that ANN's are inherently good at handling complex, multi-dimensional data models and finding any non-linear relationships [\cite{tu1996advantages}].

%Furthermore,~\cite{xie2011comparison} has found that the radial basis function network (RBFN) sub-family of ANN's handle noisy data sets very well, but is slightly less efficient than normal feed-forward networks (FFN) for classification. However, this is a small price to pay to create an accurate prediction model for the CVS's pose measurement error. 

%This section describes the steps taken in designing and testing the error prediction model, starting with the training process.

%\subsection{Model Training}

%The model training phase is a very important part of the model design process, since it is during this phase that the inter-node weighting factors are determined. The output of the prediction model is highly dependant on these inter-node weights.  

%First, the training data selection is important. 
%\subsubsection{Data Selection}

%To train a prediction model that will output accurate results, it is important to select training data across a wide spectrum in the region where the working point is most likely to be. In the case of the CVS, pose measurement vectors that contain as many pose combinations as possible, is desirable. Furthermore, it is also advantageous to have the sample vectors be uniformly distributed in a frequency histogram. Lastly, in the case of ANN's, the size of the training data set plays a significant roll in the accuracy of the training procedure: use too many samples and the model becomes over fitted, failing to capture the non-linear relationships, whereas too few samples fail to characterise the system properly. 

%The RBFN uses a supervised learning scheme where the desired output, the true CVS pose measurement error in this case, must be known. Therefore, the training data vectors were selected out of the data acquired from the Vicon test discussed in Chapter MEME, which produced pose measurement data vectors for the CVS, as well as pose measurement errors for each of the measurement vectors of the CVS. 

%To select a training data set that shows a wide variation in values while being uniformly distributed, it was opted to randomly sample a collection of vectors and test the distribution of the dimension of interest for uniformity using a $\chi^2$ test. If the dimension is uniformly distributed enough, then that collection of pose vectors is added to the training set. The process is repeated until a uniform data set for each dataimension is found. It was opted to select a total of 15 vectors per dimension, giving a total 90 training pose vectors. 

%\subsubsection{Training Process}

%Memememe

%For the training process, a supervised method is used. Here, the desired output is known and the training process attempts to fit an optimal number of radial functions, or nodes, that best describes the output data set for the given input. 

%The SciPy library's\footnote{SciPy v0.13.3} `Rbf' function was used. The function is written in such a way where it does not iteratively adjust its nodes centres to better fit the data. Instead, it sets up a linear seat of equations and solves them linearly. The sets of equations is of the form given in Equation mememe

%\begin{equation}
  %\label{eq:chap4-rbf-train}
  %Rx = y
%\end{equation}

%In Equation~\ref{eq:chap4-rbf-train}, the matrix $R$ is a matrix containing the euclidian norm distance between each node's centre. To 

%Data
%Training process - find nodes centres that best cover data, supervised
%Training params selection
%Verify


%\subsection{Model Validation}

%\section{Results}

%\section{Conclusion}


